<UserControl x:Class="SFC.Gate.Views.Violations"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SFC.Gate.Views"
             xmlns:models="clr-namespace:SFC.Gate.Models;assembly=SFC.Gate.Core"
             xmlns:vm="clr-namespace:SFC.Gate.ViewModels"
             DataContext="{Binding Source={x:Static vm:Violations.Instance}}"
             mc:Ignorable="d" 
             xmlns:cnv="clr-namespace:SFC.Gate.Converters"
             d:DesignHeight="300" d:DesignWidth="300">
    <Grid>


        <Grid IsEnabled="{Binding Source={x:Static vm:MainViewModel.Instance},Path=CurrentUser.ViolationsAccess}">
            <Grid.Effect>
                <BlurEffect Radius="{Binding Source={x:Static vm:MainViewModel.Instance},Path=CurrentUser.ViolationsAccess,Converter={cnv:BooleanToObject 0, 7},FallbackValue=10}" 
                            KernelType="Gaussian" RenderingBias="Performance"/>
            </Grid.Effect>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <DataGrid ItemsSource="{Binding Source={x:Static models:StudentsViolations.Cache}}" IsReadOnly="True"
                  x:Name="DataGrid" x:FieldModifier="private"
                  GridLinesVisibility="None"
                  Background="White"
                  Margin="10"
                  VerticalContentAlignment="Center"
                  HeadersVisibility="Column"
                  AutoGenerateColumns="False" CanUserSortColumns="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Student" Binding="{Binding Student.Fullname}"/>
                <DataGridTextColumn Header="Violation" Binding="{Binding Violation.Name}"/>
                <DataGridTextColumn Header="Date" Binding="{Binding DateCommitted}" SortDirection="Descending"/>
                <DataGridTemplateColumn Header="SMS">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate DataType="{x:Type models:StudentsViolations}">
                            <Grid>
                                <TextBlock Visibility="{Binding IsNotificationSent,Converter={cnv:BooleanToVisibility}}"
                                           TextAlignment="Center">
                                <Path HorizontalAlignment="Center"
                                      Height="17" Width="17"
                                      VerticalAlignment="Center"
                                      Margin="0"
                                      Fill="{TemplateBinding TextBlock.Foreground}"
                                    Stretch="Uniform" 
                                      Data="M28.805753,0L31.974733,0C32.167724,0.27001924 31.208732,0.60900805 30.678737,0.9630113 22.839801,6.2050091 16.330854,13.03398 10.513902,19.745 6.9349381,16.519997 3.7629682,13.021987 0,9.9210077 0.63698797,9.253986 1.4519834,8.7079969 2.4479772,8.2830092 4.1869603,9.2220036 5.6669437,10.081988 7.7689305,11.090989 8.0639258,11.23201 10.055913,12.143997 10.22591,12.136001 10.603912,12.115982 11.617896,10.918992 12.2419,10.401994 16.76185,6.6610023 23.254806,2.4390226 28.805753,0z"
                                           ToolTip="SMS notification has been sent to the student's parent or guardian."/>
                                    <Run Text="Sent" BaselineAlignment="Top"/>
                                </TextBlock>    
                                <MenuItem Header="SEND" Visibility="{Binding IsNotificationSent,Converter={cnv:BooleanToVisibility Collapsed, Visible}}"
                                        Command="{Binding Source={x:Static vm:Sms.Instance},Path=SendNotificationCommand}"
                                          VerticalAlignment="Center"
                                        Background="Transparent"
                                          Cursor="Hand"
                                          Padding="0"
                                          FontWeight="Bold"
                                        BorderThickness="0"
                                        CommandParameter="{Binding}"
                                        ToolTip="Click to notify the student's parent or guardian about this violation."/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <UniformGrid Grid.Row="1" Margin="10 0" HorizontalAlignment="Right" Columns="2">
            <Button Content="Print" Command="{Binding PrintCommand}" Margin="4" MinWidth="100"/>
            <Button Content="Clear" Command="{Binding ClearCommand}" Margin="4" MinWidth="100"/>
        </UniformGrid>
        <GroupBox Header="New Violation" Grid.Row="2" Margin="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                
                <Label Content="Student" Margin="4" Grid.Column="1"/>
                <ComboBox Grid.Column="2" Grid.Row="0" Margin="4"
                          x:Name="Student" x:FieldModifier="private"
                          DisplayMemberPath="Fullname"
                          SelectedItem="{Binding SelectedStudent}"
                          ItemsSource="{Binding Source={x:Static models:Student.Cache}}"/>

                <Label Content="Violation" Margin="4" Grid.Column="1" Grid.Row="1"/>
                <ComboBox Grid.Column="2" Grid.Row="1" Margin="4" IsEditable="True"
                          Text="{Binding Violation}" DisplayMemberPath="Name"
                          SelectedItem="{Binding SelectedViolation}"
                          ItemsSource="{Binding Source={x:Static models:Violation.Cache}}"/>

                <Label Content="Description" Margin="4" Grid.Column="1" Grid.Row="2"/>
                <TextBox Grid.Column="2" Grid.Row="2" Margin="4"
                         Text="{Binding Description}"/>
                
                <Image Source="{Binding SelectedStudent.PicturePath,Converter={cnv:PathToBitmapConverter}}"
                       Margin="4" VerticalAlignment="Top"
                       Grid.Column="0" Grid.Row="0" Grid.RowSpan="3"
                       Stretch="Uniform" Height="74"/>
                

                <Button Grid.Column="2" Grid.Row="3" HorizontalAlignment="Right"
                        Content="Save" Margin="4" Width="100"
                        Command="{Binding AddViolationCommand}"/>
            </Grid>
        </GroupBox>
    </Grid>

        <Border CornerRadius="4" HorizontalAlignment="Center"
                Visibility="{Binding Source={x:Static vm:MainViewModel.Instance},Path=CurrentUser.ViolationsAccess,Converter={cnv:BooleanToVisibility Collapsed,Visible}}"
                Background="#FF0000"
                VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal"
                        Margin="20">
                <Path Margin="4"
                      Data="M15.396557,23.044006C14.220558,23.044006 13.268559,23.886993 13.268559,24.927994 13.268559,25.975006 14.220558,26.817001 15.396557,26.817001 16.572557,26.817001 17.523547,25.975006 17.523547,24.927994 17.523547,23.886993 16.572557,23.044006 15.396557,23.044006z M15.467541,5.1819992C15.447552,5.1819992 15.436566,5.1829987 15.436566,5.1829987 13.118533,5.5049973 13.055545,7.3330002 13.055545,7.3330002L13.055545,9.2929993 13.626531,16.539001C13.983558,18.357002 14.243538,19.020004 14.243538,19.020004 15.275555,19.975006 16.203567,19.25 16.203567,19.25 16.976548,18.565994 17.028552,16.962997 17.028552,16.962997 17.956563,9.2929993 17.696553,7.1029968 17.696553,7.1029968 17.608571,5.2839966 15.823561,5.1849976 15.490551,5.1819992 15.481549,5.1819992 15.473553,5.1819992 15.467541,5.1819992z M15.56355,0C15.56355,0 21.710574,4.1259995 31.581613,2.8030014 31.581613,2.8030014 33.634629,26.556992 15.56355,32 15.56355,32 -0.10249132,27.548004 0.00050565118,2.9670029 0.0005058694,2.9670029 10.72555,3.6309967 15.56355,0z" Stretch="Uniform" Fill="#FFFFFFFF"
                      RenderTransformOrigin="0.5,0.5"/>
                <TextBlock Text="ACCESS DENIED" Foreground="White"
                           Margin="4"
                           FontWeight="Bold" FontSize="14pt"/>
            </StackPanel>

        </Border>

    </Grid>
</UserControl>
